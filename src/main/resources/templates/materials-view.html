<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Lista materialelor</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

    <script>
        // Funcția pentru calcularea prețului produsului la fiecare modificare a cantității
        function calculateProductPrice(input, price, row) {
            const quantity = input.value;
            const productPrice = quantity * price;
            row.querySelector('.product-total-price').textContent = productPrice.toFixed(2);
            calculateTotalPrice(); // Actualizăm prețul total la fiecare schimbare
        }

        // Funcția pentru calcularea prețului total al întregii coloane "Preț Produse"
        function calculateTotalPrice() {
            let total = 0;
            const rows = document.querySelectorAll('tbody tr');
            rows.forEach(row => {
                const productPriceCell = row.querySelector('.product-total-price');
                const productPrice = parseFloat(productPriceCell.textContent) || 0;
                total += productPrice;
            });

            // Afișăm prețul total
            document.querySelector('.total-price').textContent = total.toFixed(2);
        }

        // Funcția care inițializează calculul prețului pentru toate materialele din tabel
        function initializePriceCalculations() {
            const rows = document.querySelectorAll('tbody tr');
            rows.forEach(row => {
                const price = parseFloat(row.querySelector('.price').textContent);
                const input = row.querySelector('input[type="number"]');
                const productPriceCell = row.querySelector('.product-total-price');

                // Inițializăm cu valoarea implicită
                productPriceCell.textContent = '0.00';

                // Ascultăm modificările de cantitate
                input.addEventListener('input', () => calculateProductPrice(input, price, row));
            });

            // Calculăm prețul total la încărcarea paginii
            calculateTotalPrice();
        }

        // Inițializăm scriptul după încărcarea paginii
        window.addEventListener('DOMContentLoaded', initializePriceCalculations);
    </script>
</head>
<body>
<div class="container">
    <h1>Lista Materialelor</h1>

    <!-- Formular pentru adăugarea materialelor -->
    <form th:action="@{/materials}" method="post" class="mb-4">
        <div class="form-group">
            <label for="materialName">Produsul</label>
            <input type="text" class="form-control" id="materialName" name="materialName" placeholder="Introduceți produsul" required>
        </div>
        <div class="form-group">
            <label for="price">Prețul</label>
            <input type="text" class="form-control" id="price" name="price" placeholder="Introduceți prețul" required>
        </div>
        <button type="submit" class="btn btn-primary">Salvează produsul</button>
    </form>

    <!-- Formular pentru calcularea prețului total al materialelor -->
    <form th:action="@{/materials/calculate}" method="post">
        <table class="table table-striped table-hover">
            <thead class="thead-dark">
            <tr>
                <th>ID</th>
                <th>Nume Produs</th>
                <th>Pret</th>
                <th>Cantitate</th>
                <th>Pret Produse</th> <!-- Coloană pentru prețul total al produsului -->
            </tr>
            </thead>
            <tbody>
            <tr th:each="material : ${materials}">
                <td th:text="${material.id}"></td>
                <td th:text="${material.materialName}"></td>
                <td class="price" th:text="${material.price}"></td>
                <td>
                    <input type="number" th:name="'productToCount[' + ${material.id} + ']'" min="0" value="0"/>
                </td>
                <td class="product-total-price">0.00</td> <!-- Celulă pentru prețul produsului -->
            </tr>
            </tbody>
        </table>

        <!-- Afișăm prețul total în locul butonului -->
        <div class="mt-4">
            <h3>Preț Total: <span class="total-price">0.00</span></h3>
        </div>
    </form>
</div>
</body>
</html>
